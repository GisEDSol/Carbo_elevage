---
title: "Mode opératoire pour l'importation et l'utilisation du dépôt svn webservices dans une machine locale"
author: "Jean-Baptiste Paroissien"
date: "24/09/2014"
output:
  html_document:
    fig_caption: yes
    highlight: zenburn
    number_sections: yes
    theme: spacelab
    toc: yes
rerCat: Preparation
tags: Importation dépôt svn
categories: Preparation
---
```{r, tidy=FALSE,eval=TRUE,echo=FALSE}
mo_url <- "https://forge.orleans.inra.fr/projects/infosol/repository/entry/Modes_operatoires/"
pro_url <- "https://forge.orleans.inra.fr/projects/infosol/repository/entry/Procedure/"
```
# Objectif et domaine d'application
Ce document décrit l'organisation du dépôt svn du projet webservice ainsi que les étapes pour importer, mettre à jour et alimenter le dépôt.

| Type utilisateur | Systèmes d'exploitation | Langages |
|------------------|-------------------------|----------|
| Producteurs      | Linux                   | bash     |

# L'arborescence du dépôt
L'arborescence du dépôt du projet webservice est présentée ci-dessous. Le répertoire trunk correspond au répertoire de développement du projet. Le répertoire tag est un répertoire où sont placées les versions stables des travaux réalisés. Pour le moment, ce répertoire est vide car le projet est en cours de développement.

`Important` : Les fichiers lisezMoi sont présents à chaque noeud de l'arborescence pour faciliter la navigation dans le dépôt. Ils décrivent de façon simple le contenu des répertoires.

```{r, tidy=FALSE,eval=FALSE}
.
├── tag
└── trunk
    ├── Documentation
    │   ├── Modes_operatoires
    │   ├── Procedure
    │   ├── Processus
    │   └── Template
    ├── Fichiers_suivis
    │   ├── BDETM
    │   ├── Metawebservices
    │   └── RMQS
    ├── Fonctions
    │   ├── bash
    │   ├── python
    │   └── R
    └── LisezMoi
```
## Le répertoire trunk 

Le répertoire trunk contient les 2 répertoires suivants :

| Nom répertoire  | Description                                                                            |
|-----------------|----------------------------------------------------------------------------------------|
| Documentation   | Répertoire contenant la documentation du projet                                        |
| Fonctions       | Répertoire contenant les différentes fonctions génériques du projet                    |
| Fichiers_suivis | Répertoire contenant les fichiers de suivis relatifs à la construction des webservices |

### Répertoire *Fichiers_suivis*

Ce répertoire regroupe les fichiers de suivis permettant de publier les données des programmes BDETM et RMQS. Le stockage des fichiers de suivis est organisé par programme (BDAT, RMQS) et ensuite par type de données diffusées (raster ou vecteur). Dans le cas des données raster, la chaine de traitement de diffusion de la données est organisée par répertoire (nom du type de raster), puis organisée de la manière suivante :

- adaptation : Répertoire de stockage pour les fonctions propre à la création du raster
- base : Répertoire de stockage des fichiers originaux
- suivi : Répertoire de stockage des fichiers de suivi 

Pour la diffusion de données de type vecteur, le répertoire contient un sous-répertoire `suivi` contenant le fichier de suivi de la donnée diffusée. Pour plus d'informations sur la rédaction des fichiers de suivi, voir le [mode opératoire](`r mo_url`MO_fichiersuivi.html) consacré.

`Important` : Pour faciliter la recherche des fichiers, tous les noms de fichiers de suivi doivent être structurés de la manière suivante : "FS_nomexplicite".

```{r, tidy=FALSE,eval=FALSE}
.
├── BDETM
└── RMQS
    ├── Raster
    │   ├── biomasse
    │   │   ├── adaptation
    │   │   ├── base
    │   │   └── suivi
    │   ├── etm
    │   │   ├── adaptation
    │   │   ├── base
    │   │   ├── LisezMoi
    │   │   └── suivi
    │   └── stockcarbone
    │       ├── adaptation
    │       ├── base
    │       └── suivi
    └── Vecteur
        └── cartogramme
            └── suivi
```

### Répertoire *Documentation*

Ce répertoire contient la documentation associé au projet :

- Modes_operatoires : Stockage des différents modes opératoires (fichiers de type .Rmd)
- Procedure : Stockage des différentes procédures (procédure utilisateur, producteur et administrateur)
- Processus : Stockage du document processus
- Template : Stockage des différents modèles de documents

`Important` : Pour faciliter la recherche des fichiers, tous les noms des modes opératoires doivent être structurés de la manière suivante : "MO_nomexplicite".

```{r, tidy=FALSE,eval=FALSE}
.
├── Modes_operatoires
├── Procedure
├── Processus
└── Template
```

### Répertoire *Fonctions*

Ce répertoire contient les fonctions génériques du projet. Le répertoire `bash` contient les fonctions en *bash*, le répertoire `R	` les fonctions *R* et `python` les fonctions codées en *python*.

```{r, tidy=FALSE,eval=FALSE}
.
├── bash
│   ├── createntrepot.sh
│   ├── ftoinspire.sh
│   ├── metatogeonetwork.sh
│   ├── montagetopdf.sh
│   ├── rtogeoserver_ids.sh
│   ├── rtogeoserver.sh
│   ├── rtojdbcmosaic.sh
│   ├── rtomosaic.sh
│   ├── sldtogeoserver.sh
│   └── vtogeoserver.sh
├── python
│   └── xml_to_mef.py
└── R
    ├── CartogrammeSLD
    │   ├── cartogrammesld_0.R
    │   ├── cartogrammesld_1.R
    │   └── cartogrammesld_2.R
    ├── catalogage
    │   └── catalogage.R
    ├── ChoropletheSLD
    │   └── choropleth_sld.R
    ├── CreationPaquets
    │   ├── creatpaquet.pdf
    │   ├── creatpaquets.R
    │   └── creatpaquets_v2.R
    ├── Fiche_evaluation
    │   └── fiche_eval.R
    └── rtopostgis
        └── rtopostgis.R
```

# Utilisation du dépôt

## Importation du projet : **checkout**
Le checkout est l'opération qui consiste à récupérer pour la première fois les fichiers déjà existant au sein d'un projet du dépôt subversion.

```{r, tidy=FALSE,eval=FALSE}
svn co svn+ssh://nomutilisateur@acklins/var/svn/svn-repos/equipe_traitement/webservices
```

## Synchronisation de la copie de travail : **update**
L'update consiste à synchroniser la copie de travail locale avec le dépôt en récupérant la dernière version des fichiers du dépôt.

```{r, tidy=FALSE,eval=FALSE}
svn update svn+ssh://paroissien@acklins/var/svn/svn-repos/equipe_traitement/webservices/ repertoire_de_stockage
```

## Mise à jour du dépôt : **commit**

Le commit est l'opération inverse d'un update. Elle consiste à mettre à jour le dépôt à partir de la copie de travail locale. Une nouvelle révision est alors créée. Un log (simple message texte contenant une description des modifications effectuées) doit être saisi à cette occasion. À noter que pour qu'un commit soit possible, il faut que la copie de travail corresponde à la dernière version du dépôt (modifications locales exceptées). Si ce n'est pas le cas, il est nécessaire d'effectuer d'abord un update et de résoudre les conflits éventuels avant de réessayer le commit.

```{r, tidy=FALSE,eval=FALSE}
svn commit -m "simple message texte contenant une description des modifications effectuées"
```

Pour plus de détails sur les commandes `svn`, vous pouvez consulter ce [site web](http://dev.nozav.org/intro_svn.html).


