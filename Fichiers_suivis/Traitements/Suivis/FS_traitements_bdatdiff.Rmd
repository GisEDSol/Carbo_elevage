---
title: "Traitement des données de la BDAT : Evolution des teneurs en carbone organique"
author: "Jean-Baptiste Paroissien"
date: "09/03/2017"
output:
  github_document:
    toc: true
    toc_depth: 2
    fig_width: 10
    fig_height: 10
    dev: png
    md_extensions: +autolink_bare_uris+hard_line_breaks+header_attributes+line_blocks+table_captions
---


```{r setup, include=FALSE,eval=TRUE,echo=FALSE}
# Importation des paramètres de travail
source("/media/sf_GIS_ED/Dev/Scripts/master/Fonctions/R/importparametres.R")
repmaster <- "/media/sf_GIS_ED/Dev/Scripts/master/"
importparametres(repmaster=repmaster,repdata="/media/sf_GIS_ED/Dev/",dsn="PG:dbname='sol_elevage' host='localhost' port='5432' user='jb'")
repsortie <- paste(repmaster,"/Fichiers_suivis/Traitements/Fichiers/",sep="") #répertoire de sortie pour des différents fichiers

set.seed(157) #Pour la reproductibilité
cl <- makeCluster(4);registerDoParallel(cl) #Configuration pour le calcul parallel

```
```{r,eval=TRUE,echo=FALSE}
## This chunck will read through *this* Rmd file, and attempt to extract all of the 
## labels (not caption text) used for Figure captions. These labels are used
## as anchors, so scanning through the document now will allow us to create cross references
## before the caption actually appears. 

## Get the name of this Rmd file
rmdFn <- knitr::current_input()  # filename of input document

## Read lines and close connection
rmdCon <- file(rmdFn, open = "r")
rmdLines <- readLines(rmdCon)
close(rmdCon)

## Pull out all occurences of at least one back tick, followed 
## by any number of characters, followed by fig$cap (all on one line)
figscap_idx <- grep("`+(.*)fig\\$cap", rmdLines)
rmdLines <- rmdLines[figscap_idx]

## Get rid of everything up until the start of the caption label
## This presumes the caption label is the first argument of fig$cap()
## E.g., fig.cap = fig$cap("my_label", ...)
rmdLinesSansPre <- sub("(.*)fig\\$cap(.*?)[\"']", "", rmdLines)

## Identify everything up until the first quote
match_data <- regexpr("(.*?)[\"']", rmdLinesSansPre)

## Reduce the length by one, because we're not interested in the final quote
attr(match_data, "match.length") <- attr(match_data, "match.length") - 1

## Extract
fig_labels <- regmatches(rmdLinesSansPre, match_data, invert=FALSE)

if (length(fig_labels) > 0) {

    ## Test for duplicates
    if (anyDuplicated(fig_labels) > 0) stop("Duplicate caption labels detected")
    
    ## Create a named list of Figure numbers
    ref <- as.list(1:length(fig_labels))
    names(ref) <- fig_labels
}    
```

```{r, tidy=FALSE,eval=FALSE,echo=FALSE}
Sys.Date()
sessionInfo()
```

```{r,highlight=TRUE,eval=TRUE,echo=FALSE,warning=FALSE}
# Lecture des tables de travail

##RA
tablename <- paste("dm_traitements.","melted_ra",sep="")
melted.ra <- sqlQuery(loc,paste("select * from ",tablename,sep=""))
melted.radiff <- sqlQuery(loc,paste("select * from ",tablename,"diff",sep=""))
melted.radiff <- melted.radiff[complete.cases(melted.radiff$value) & complete.cases(melted.radiff$zonage_simple) & complete.cases(melted.radiff$zonage_cplt),]
melted.ra <- melted.ra[complete.cases(melted.ra$value) & complete.cases(melted.ra$zonage_simple) & complete.cases(melted.ra$zonage_cplt),]
melted.ra$annees <- factor(melted.ra$annees)

##BDATDiff
melted.bdatdiff <- sqlQuery(loc,paste("select * from dm_traitements.melted_bdatdiff",sep=""))#,as.is=c(FALSE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,FALSE))
melted.bdatdiff$diffmedian <- as.numeric(melted.bdatdiff$diffmedian)
melted.bdatdiff <- melted.bdatdiff[complete.cases(melted.bdatdiff$diff_corgox),]

##BDAT
melted.9514 <- sqlQuery(loc,paste("select * from dm_traitements.melted_bdat_9514",sep=""),as.is=c(FALSE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,FALSE))
melted.9514$value <- as.numeric(melted.9514$value)
melted.9514 <- melted.9514[complete.cases(melted.9514$value),]
melted.9514$annees <- factor(melted.9514$annees,levels=c("9599","0004","0509","1014"))

# Sélection des teneurs mesurées avec la méthode OX
melted.9514 <- melted.9514[melted.9514$variable %in% "corgox",]

# Jeu de données sur 4 périodes de temps
bdat9514 <- sqlQuery(loc,paste("select * from dm_vecteurs.canton_9514",sep=""))

# Changement du nom des tables pour l'exploitation rapide dans le fichier de suivi
dcast.bdat <- bdat9514
melted.bdat <- melted.9514 
```

# Objectifs

Dans ce fichier, la différence des teneurs en carbone organique à l'échelle du canton est étudiée pour un ensemble de périodes comparé. Ces résultats ont été fournis par InfoSol et résultent d'un ré-échantillonnage des analyses de la bdat communales réalisées 100 fois. Au cours de ces répétitions, les teneurs en CO sont comparées pour 2 périodes données et un test statistique est réalisé pour connaître la significacité des différences à l'échelle du canton. Pour une description de la méthode utilisée, le lecteur intéressé peut consulter les articles suivants :

- [Lemercier et al.,2006](https://www.google.fr/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0ahUKEwj9uNzhwNPSAhXKfRoKHVxVBtIQFggcMAA&url=http%3A%2F%2Fwww.afes.fr%2Fafes%2Fegs%2FEGS_13_3_lemercier.pdf&usg=AFQjCNHmQCmyJgF7DgYTWGYn3XDTPIHSlA)
- [Saby et al.,2008](http://onlinelibrary.wiley.com/doi/10.1111/j.1475-2743.2008.00159.x/abstract)
- [Swiderski et al.,2012](https://www.google.fr/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=0ahUKEwjXi4-DwdPSAhVIbBoKHYalCcwQFggcMAA&url=http%3A%2F%2Fwww.afes.fr%2Fafes%2Fegs%2FEGS_19_3_swideski_web.pdf&usg=AFQjCNEKtp34NnAEJ6_BEZURnh_DC-Lf3A)

Les résultats de ces tests sont réalisés à l'échelle de la France de la manière suivante :

- Identifier la distribution spatiale de l'évolution à l'échelle de la france : Cartographie, boxplot du nombre de canton qui évolue par différents niveaux de stratification
- Analyse de la distribution. Quelle sont les principaux facteurs qui expliquent ces évolutions ?

# Analyse de l'évolution des teneurs en carbone organique à l'échelle nationale

A l'échelle nationale et pour toutes les périodes comparées, la proportion de canton ayant une évolution significative des teneurs en CO (augmentation ou diminution) est inférieure à 30%. Dans cette part, il y a quasiment autant de canton enregistrant une augmentation qu'une diminution des teneurs (`r table(melted.bdatdiff[,"diff_corgox"])[[1]]` et `table(melted.bdatdiff[,"diff_corgox"])[[2]]` respectivement).

```{r,highlight=TRUE,eval=TRUE,echo=FALSE,fig.height=6, fig.width=10,fig.cap = fig$cap("histo_evolution",""),fig.align="center"}
bdatdiff <- melted.bdatdiff

p_fr <- ggplot(bdatdiff,aes(x=factor(1),fill=diff_corgox)) + geom_bar(aes(y = (..count..)/sum(..count..))) + scale_y_continuous(labels=percent) + scale_fill_brewer(palette = 'Paired',name="Evolution des teneurs en C")+
                    xlab("Type d'évolution")+ylab("Nombre de canton")+                
                    theme(plot.title = element_text(size = 14, face = "bold"), 
                    text = element_text(size = 12),
                    axis.title = element_text(face="bold"),
                    axis.text.x=element_text(size = 11))
p_fr
```

## Analyse du nombre d'évolution significative par canton

La figure `r fig$ref("histo_evolution_elevage_climat",link=TRUE)` présente un histogramme du nombre de canton ayant connu une augmentation ou une diminution significative des teneurs en carbone organique. L'histogramme est appliqué sur toutes les périodes et stratifié par zones d'élevage.
La figure montre un équilibre entre le nombre de canton ayant eu une augmentation et le nombre de canton ayant eu une diminution de la teneur en carbone organique. La proportion des zones d'élevage entre les classes d'augmentation et de diminution est relativement équilibrée mais quelques zones se distinguent :

- Les régions B1, C2 et D sont davantage affectées par la diminution des teneurs en C
- Les région A et C1 sont plus affectées par des augmentations que des diminutions. 

```{r,highlight=TRUE,eval=TRUE,echo=FALSE,fig.height=6, fig.width=10,fig.cap = fig$cap("histo_evolution_elevage_climat",""),fig.align="center"}
# Histogramme des valeurs 
p <- list()

p[[1]] <- ggplot(bdatdiff,aes(zonage_cplt,fill=diff_corgox)) + geom_bar(position="fill") + #scale_y_continuous(labels = percent_format())+
 #geom_bar()+
#                    facet_grid(~period) +
                    scale_fill_brewer(palette = 'Paired',name="Evolution des teneurs en C")+
                    xlab("Zones d'élevage")+ylab("Pourcentage de canton")+ scale_y_continuous(labels=percent)+
                    theme(plot.title = element_text(size = 14, face = "bold"), 
                    text = element_text(size = 12),
                    axis.title = element_text(face="bold"),
                    axis.text.x=element_text(size = 11))

p[[2]] <- ggplot(bdatdiff,aes(typo_clim,fill=diff_corgox)) + geom_bar(position="fill") + #scale_y_continuous(labels = percent_format())+
 #geom_bar()+
#                    facet_grid(~period) +
                    scale_fill_brewer(palette = 'Paired',name="Evolution des teneurs en C")+
                    xlab("Type de climat")+ylab("Pourcentage de canton")+scale_y_continuous(labels=percent)+
                    theme(plot.title = element_text(size = 14, face = "bold"), 
                    text = element_text(size = 12),
                    axis.title = element_text(face="bold"),
                    axis.text.x=element_text(size = 11))    
                    #geom_bar(position="dodge")

tt <- do.call(grid_arrange_shared_legend,c(p,list(nrow=1,ncol=2,position="bottom")))
```

Dans la figure `r fig$ref("histo_evolution_period_elevage",link=TRUE)`, les histogrammes sont analysés pour des écarts entre les périodes étudiées d'au moins 10 ans. La figure montre des différences importantes entre les périodes analysées :

- L'évolution des teneurs est équilibrée entre les périodes [1994-1999]-[2010-2014] et les périodes [1990-1994]-[2010-2014],
- Les différences entre les périodes [1990-1994]-[2000-2004] et [1994-1999]-[2005-2009] montrent une part importante pour la diminution des teneurs en CO. Dans une moindre mesure, la différence entre les périodes [1990-1994]-[2005-2009] présente une part de diminution des teneurs en CO plus importante que l'augmentation.
- A l'inverse, les teneurs en CO ont augmenté majoritairement entre les périodes [2000-2004]-[2010-2014].

```{r,highlight=TRUE,eval=TRUE,echo=FALSE,fig.height=6, fig.width=12,fig.cap = fig$cap("histo_evolution_period_elevage",""),fig.align="center"}
bdatdiff <- subset(melted.bdatdiff,diff_corgox!="Non significatif")
periodetud <- c("14","24","15","25","13","35")

# Pour voir...
enplus <- c("12","45","23")
periodetud <- c(periodetud,enplus)

bdatdiff <- bdatdiff[bdatdiff$period %in% periodetud, ]
bdatdiff$diff_corgox <- as.factor(bdatdiff$diff_corgox)

histo_varprairie <- ggplot(bdatdiff,aes(diff_corgox,fill=classe_var_prairie1970_2010)) + geom_bar() + facet_wrap(~ period)+
                    scale_fill_brewer(palette = 'Paired',name="Evolution des prairies % (1970-2010")+
                    xlab("Type d'évolution des teneurs en carbone organique")+ylab("Nombre de canton")+
                    theme(plot.title = element_text(size = 14, face = "bold"), 
                    text = element_text(size = 12),
                    axis.title = element_text(face="bold"),
                    axis.text.x=element_text(size = 11))    
                    #geom_bar(position="dodge")
histo_varprairie
#ggsave(histo_regelevage,file = paste(repsortie,"histo_regelevage.png",sep=""), width = 12, height = 6)  
```
> **En conclusion** de cette section, on constate plusieurs points :
- Les évolutions des teneurs en C entre les différentes périodes ne suivent pas les mêmes tendances. Les premières observation vues dans [FS_traitements_bdat.Rmd](`r github_url`Fichiers_suivis/Traitements/Suivis/FS_traitements_bdat.Rmd) se confirment. Les teneurs en C ont augmenté sur la période [2010-2014] et cette augmentation est particulièrement prononcée entre les périodes [2000-2004]-[2010-2014].
- La diminution des teneurs est surtout observée entre [1990-1994]-[2000-2004] et [1994-1999]-[2005-2009] et [1990-1994]-[2005-2009].
- Les principales zones d'élevage affectées par ces changements sont : A, B1, C1, C2 et D. Ce résultat provient surtout de la densité d'analyse dans ces zones et de leur étendue spatiale.

## Analyse sur les périodes identifiées

Dans la suite, on s'intéressera uniquement aux périodes concernées par les changements importants idenfiés dans le paragraphe précédent, à savoir : 

- 35 [2000-2004]-[2010-2014],
- 13 [1990-1994]-[2000-2004],
- 24 [1995-1999]-[2005-2009],
- 14 [1990-1994]-[2005-2009].

```{r,highlight=TRUE,eval=TRUE,echo=FALSE,fig.height=5, fig.width=14,fig.cap = fig$cap("bar_prairie","Histogramme à commenter"),fig.align="center"}
# Sélection des cantons aux diminutions significatives
bdatdiff_classe <- melted.bdatdiff[complete.cases(melted.bdatdiff$diff_corgox) & melted.bdatdiff$diff_corgox !="Non significatif",]
periodetud <- c("13","24","35","14")
zone_elevage <- c("A","B1","C1","C2","D")

bdatdiff_classe <- bdatdiff_classe[(bdatdiff_classe$period %in% periodetud) & (bdatdiff_classe$zonage_cplt %in% zone_elevage),]
bdatdiff_classe$diff_corgox <- as.factor(bdatdiff_classe$diff_corgox)

# Histogramme des valeurs 
histo_regionadmin <- ggplot(bdatdiff_classe,aes(diff_corgox,fill=nom_region)) + geom_bar(position="dodge") + facet_wrap(~ period) + 
                    xlab("Classe d'évolution des teneurs en carbone organique")+ylab("Nombre de canton")+
                    theme(plot.title = element_text(size = 14, face = "bold"), 
                    text = element_text(size = 12),
                    axis.title = element_text(face="bold"),
                    axis.text.x=element_text(size = 11),
                    legend.position="bottom")                      
histo_regionadmin
#ggsave(histo_regionadmin,file = paste(repsortie,"histo_regionadmin.jpg",sep=""), width = 14, height = 5)  
```
De la figure ci-dessus, les 10 principales régions touchées par des évolutions significatives sont présentées dans le tableau ci-dessous.

```{r,highlight=TRUE,eval=TRUE,echo=FALSE,results='asis'}
# Sélection
histo_table <- count(bdatdiff_classe,c("diff","nom_region","period"))
histo <- histo_table[order(-histo_table[,"freq"]),][1:10,]
pander(histo,style = "rmarkdown",caption = "Principales régions touchées par des évolutions significatives")
```

La région Centre et les pays de la Loire ont une fréquence importante de canton ayant une augmentation de C.
Le Nord-pas-de-Calais, la Bretagne, la Picardie et la région Poitou-Charentes sont les principales régions touchées par des diminutions en C.

## Cartographie des évolutions

On retrouve ces observations sur les cartes d'évolution des teneurs. Dans le détail, c'est le morbihan qui est surtout affecté par des chutes de teneurs en carbone organique et en région Centre, on observe une augmentation des teneurs concentrée dans le Perche.
Ces résultats très ciblés font penser à un effet de bord (différences liés aux laboratoires?), surtout pour les régions Picardie, Nord-Pas-De-Calais et le département du Morbihan. **La suite des analyses se concentrera sur ces zones.**

```{r,highlight=TRUE,eval=FALSE,echo=FALSE,warning=FALSE,message=FALSE}
# Cartographie des résultats des tests statistiques
tablecarto <- "dm_vecteurs.canton" 
variablecarto <- c("diffmedian_corgox13","diffmedian_corgox24","diffmedian_corgox35","diffmedian_corgox14") #variable à spatialiser
l_legend <- "Evolution des teneurs en C"#label de la variable
nclasse <- 4 #Nombre de classes de valeurs pour la cartographie
style_classe <- "quantile" #"pretty"#"jenks","fixed"
couleur <- "Spectral"#nom de la palette couleur (selon RColorBrewer)display.brewer.all() pour connaître les différentes palettes
nomfichier <- "Median_evolu_corgox"

carto(dsn,tablecarto,variablecarto,nclasse,style_classe,couleur,l_legend,repsortie,nomfichier,dept=FALSE,reg=FALSE,nrowlayout=2,ncollayout=2,position="bottom",ggsaveheight=10,ggsavewidth=10)

variablecarto <- c("diff_corgox13","diff_corgox24","diff_corgox35","diff_corgox14") #variable à spatialiser
l_legend <- "Evolution des teneurs en C"#label de la variable
nclasse <- 4 #Nombre de classes de valeurs pour la cartographie
style_classe <- "fixed" #"pretty"#"jenks","fixed"
couleur <- "Set1"#nom de la palette couleur (selon RColorBrewer)display.brewer.all() pour connaître les différentes palettes
nomfichier <- "Median_diff_corgox"

carto(dsn,tablecarto,variablecarto,nclasse,style_classe,couleur,l_legend,repsortie,nomfichier,dept=FALSE,reg=FALSE,nrowlayout=2,ncollayout=2,position="bottom",ggsaveheight=10,ggsavewidth=10)
```

```{r map_evol_fr, echo = FALSE, eval=TRUE,results = 'asis'}
# Pour insérer l'image
nomfichier <- c("Median_evolu_corgox.png","Median_diff_corgox.png")
fichiers <- paste(repsortie,nomfichier,sep="")
cat(paste("![](",fichiers,")",sep=""))
```


# test


```{r,eval=FALSE,echo=FALSE}
melted.9014 <- sqlQuery(loc,paste("select * from dm_traitements.melted_bdat_9014",sep=""),as.is=c(FALSE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,FALSE))
melted.9014$value <- as.numeric(melted.9014$value)
melted.9014 <- melted.9014[complete.cases(melted.9014$value),]
melted.9014$annees <- factor(melted.9014$annees,levels=c("9094","9599","0004","0509","1014"))

reg_focus <- c("31","22")
melted_focus <- melted.9014[melted.9014$code_reg %in% reg_focus,]
#levels(melted_focus$annees) <- c("1979","1988","2000","2010")
melted.ra_focus <- melted.ra[melted.ra$code_reg %in% reg_focus & melted.ra$variable %in% c("p_c","p_mf","p_prairie","p_sfp"),]

#http://drawar.github.io/posts/dual-y-axis-ggplot2/

p_bdat <- ggplot(melted_focus) + 
          geom_smooth(aes(x=as.integer(annees),y=value),color="black",method=loess)+
          #geom_smooth(method = "loess", se=FALSE, color="black", aes(group=1))+
          scale_y_continuous("Teneur en carbone organique (g/kg)")+
          theme(plot.title = element_text(size = 14, face = "bold"), 
                text = element_text(size = 12),
                axis.title = element_text(face="bold"),
                axis.text.x=element_text(size = 11))

melted.ra_focus <- melted.ra[melted.ra$code_reg %in% reg_focus  & melted.ra$annees %in% c("1979","1988","2000","2010") & melted.ra$variable %in% c("p_c","p_mf","p_prairie","p_sfp"),]
melted.ra_focus$annees <- factor(melted.ra_focus$annees,levels=c("1979","1988","2000","2010"))

colors <- brewer.pal(4,"Set1")#wes_palette("Rushmore",nperiod,type="continuous")
p_ra <- ggplot(melted.ra_focus) +
#            geom_boxplot(aes(x=annees,y=value,col=variable))+
            geom_smooth(aes(x=as.integer(annees),y=value,color=variable),method=loess)+
            scale_color_manual(values=colors,name="Occupation du sol")+
            scale_y_continuous("% d'occupation du sol")+
            theme(plot.title = element_text(size = 14, face = "bold"), 
                  text = element_text(size = 12),
                  axis.title = element_text(face="bold"),
                  axis.text.x=element_text(size = 11),
                  legend.position="bottom")

tt <- grid.arrange(p_bdat,p_ra)


# make gtable objects from ggplot objects
# gtable object shows how grobs are put together to form a ggplot
library(gtable)
library(grid) # low-level grid functions are required
g1 <- ggplotGrob(p1)
g1 <- gtable_add_cols(g1, unit(0,"mm")) # add a column for missing legend
g2 <- ggplotGrob(p2)
g <- rbind(g1, g2, size="first") # stack the two plots
g$widths <- unit.pmax(g1$widths, g2$widths) # use the largest widths
# center the legend vertically
g$layout[grepl("guide", g$layout$name),c("t","b")] <- c(1,nrow(g))
grid.newpage()
grid.draw(g)g1 <- ggplot_gtable(ggplot_build(p_bdat))
g2 <- ggplot_gtable(ggplot_build(p_ra))

# get the location of the panel of p1 
# so that the panel of p2 is positioned correctly on top of it
pp <- c(subset(g1$layout, name == "panel", se = t:r))

# superimpose p2 (the panel) on p1
g <- gtable_add_grob(g1,g2$grobs[[which(g2$layout$name == "panel")]], pp$t, 
pp$l, pp$b, pp$l)
grid.draw(g)


# extract the y-axis of p2
ia <- which(g2$layout$name == "axis-l")
ga <- g2$grobs[[ia]]
ax <- ga$children[[2]]

# flip it horizontally
ax$widths <- rev(ax$widths)
ax$grobs <- rev(ax$grobs)

# add the flipped y-axis to the right
g <- gtable_add_cols(g, g2$widths[g2$layout[ia, ]$l], length(g$widths) - 1)
g <- gtable_add_grob(g, ax, pp$t, length(g$widths) - 1, pp$b)
grid.draw(g)



library(gtable)
library(grid) # low-level grid functions are required
g1 <- ggplotGrob(p1)
g1 <- gtable_add_cols(g1, unit(0,"mm")) # add a column for missing legend
g2 <- ggplotGrob(p2)
g <- rbind(g1, g2, size="first") # stack the two plots
g$widths <- unit.pmax(g1$widths, g2$widths) # use the largest widths
# center the legend vertically
g$layout[grepl("guide", g$layout$name),c("t","b")] <- c(1,nrow(g))
grid.newpage()
grid.draw(g)










#http://stackoverflow.com/questions/9916194/two-color-scales-for-geom-line-in-ggplot2

ggplot(exShapedMayGroup, aes_string(x="Date", y="Score")) + 
geom_line(aes_string(group=".id", linetype=".id")) +  
geom_point() + 
geom_line(aes_string(y="Lower", colour="Right")) + 
geom_line(aes_string(y="Upper", colour="Right")) + 
scale_linetype_discrete(name="Group") + scale_color_discrete(name="Limits")
```


# Evolution globale des teneurs en CO par rapport aux teneurs initiales

## A l'échelle de la France

```{r,eval=FALSE,echo=FALSE}
# Lecture du fichier présentant les différentes périodes analysées
nomdiff <- read.csv(paste(repmetadonnees,"Nomenclature_evolutionbdat.csv",sep=""),sep=",",colClasses = "character")
coname <- "corgox"
periodetud <- c("14","24","15","25","13","35")

p <- list()
r2 <- list()

for(i in periodetud){
        y <- paste("diffmedian_",coname,i,sep="")
        teststats <- paste("diff_",coname,i,sep="")
        x <- paste(coname,nomdiff[nomdiff$Code %in% i,"Periode1"],sep="")
        xyNames <- c(x,y,teststats)

        dd <- dcast.bdat[complete.cases(dcast.bdat[,xyNames]),][,xyNames]    

        if(nrow(dd) < 15){
            next
        }else{}

        xlabel <- paste("CO ",x,sep="")
        ylabel <- paste("Différence CO",i,sep="")

        p[[i]] <- ggplot(dd, aes_string(x,y)) +
                geom_point(aes_string(colour = teststats),alpha = 0.8, size = 1) +
                scale_x_continuous(xlabel)+scale_y_continuous(ylabel)+
                theme(plot.title = element_text(size = 14, face = "bold"), 
                text = element_text(size = 12),
                axis.title = element_text(face="bold"),
                axis.text.x=element_text(size = 11))+ labs(title=i)+
                annotate("text", x=20, y=10, label=lm_eqn(lm(dd[,y]~dd[,x], dd)), parse=TRUE)+
                geom_smooth(method = "lm", se = FALSE,color="black")
        r2[[i]] <- summary(lm(dd[,y]~dd[,x]))$r.squared
}
pcplt <- do.call(grid_arrange_shared_legend,c(p,list(nrow=2,ncol=3,position="bottom")))
stats_r2 <- as.data.frame(melt(r2))
colnames(stats_r2) <- c("R2","Period")
save(stats_r2,file=paste(repsortie,"diff_initial_frR2.RData",sep=""))

```


## Analyse par strates

### Type de climat

```{r,eval=FALSE,echo=FALSE}
# Lecture du fichier présentant les différentes périodes analysées
nomdiff <- read.csv(paste(repmetadonnees,"Nomenclature_evolutionbdat.csv",sep=""),sep=",",colClasses = "character")
coname <- "corgox"
periodetud <- c("14","24","15","25","13","35")
strates <- 1:8

rest <- list()
for(s in strates){
    
    d_typo <- dcast.bdat[dcast.bdat$typo_clim %in% s,]
    p <- list()
    r2 <- list()
    
    for(i in periodetud){
        y <- paste("diffmedian_",coname,i,sep="")
        teststats <- paste("diff_",coname,i,sep="")
        x <- paste(coname,nomdiff[nomdiff$Code %in% i,"Periode1"],sep="")
        xyNames <- c(x,y,teststats)

        dd <- d_typo[complete.cases(d_typo[,xyNames]),][,xyNames]    

        if(nrow(dd) < 15){
            next
        }else{}

        xlabel <- paste("CO ",x,sep="")
        ylabel <- paste("Différence CO",i,sep="")

        p[[i]] <- ggplot(dd, aes_string(x,y)) +
                geom_point(aes_string(colour = teststats),alpha = 0.8, size = 1) +
                scale_x_continuous(xlabel)+scale_y_continuous(ylabel)+
                theme(plot.title = element_text(size = 14, face = "bold"), 
                text = element_text(size = 12),
                axis.title = element_text(face="bold"),
                axis.text.x=element_text(size = 11))+ labs(title=i)+
                annotate("text", x=20, y=10, label=lm_eqn(lm(dd[,y]~dd[,x], dd)), parse=TRUE)+
                geom_smooth(method = "lm", se = FALSE,color="black")
        r2[[i]] <- summary(lm(dd[,y]~dd[,x]))$r.squared
        }
    stats_r2 <- as.data.frame(melt(r2))
    colnames(stats_r2) <- c("R2","Period")
    rest[[s]] <- stats_r2
    
    pcplt <- do.call(grid_arrange_shared_legend,c(p,list(nrow=2,ncol=3,position="bottom")))
    ggsave(pcplt,file = paste(repsortie,"diff_initial_clim",s,".png",sep=""), width = 10, height = 6)
}

save(rest,file=paste(repsortie,"diff_initial_climR2.RData",sep=""))
```

Figure à commenter 

```{r,eval=FALSE,echo=FALSE}
load(paste(repsortie,"diff_initial_climR2.RData",sep=""))
test2 <- melt(rest)

ggplot(test2, aes(x=Period,y=value)) + facet_wrap(~L1) + geom_boxplot() +
  scale_x_discrete("Périodes")+scale_y_continuous("Teneur en carbone organique (g/kg)")+
  theme(plot.title = element_text(size = 14, face = "bold"), 
        text = element_text(size = 12),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11))

```

### Région d'élevage

```{r,eval=FALSE,echo=FALSE}
# Lecture du fichier présentant les différentes périodes analysées
nomdiff <- read.csv(paste(repmetadonnees,"Nomenclature_evolutionbdat.csv",sep=""),sep=",",colClasses = "character")
coname <- "corgox"
periodetud <- c("14","24","15","25","13","35")
strates <- c("A","B1","B2","C1","C2","D","E1","E2","G1","G2")

rest <- list()
for(s in strates){
    
    d_typo <- dcast.bdat[dcast.bdat$zonage_cplt %in% s,]
    p <- list()
    r2 <- list()
    
    for(i in periodetud){
        y <- paste("diffmedian_",coname,i,sep="")
        teststats <- paste("diff_",coname,i,sep="")
        x <- paste(coname,nomdiff[nomdiff$Code %in% i,"Periode1"],sep="")
        xyNames <- c(x,y,teststats)

        dd <- d_typo[complete.cases(d_typo[,xyNames]),][,xyNames]    

        if(nrow(dd) < 15){
            next
        }else{}

        xlabel <- paste("CO ",x,sep="")
        ylabel <- paste("Différence CO",i,sep="")

        p[[i]] <- ggplot(dd, aes_string(x,y)) +
                geom_point(aes_string(colour = teststats),alpha = 0.8, size = 1) +
                scale_x_continuous(xlabel)+scale_y_continuous(ylabel)+
                theme(plot.title = element_text(size = 14, face = "bold"), 
                text = element_text(size = 12),
                axis.title = element_text(face="bold"),
                axis.text.x=element_text(size = 11))+ labs(title=i)+
                annotate("text", x=20, y=10, label=lm_eqn(lm(dd[,y]~dd[,x], dd)), parse=TRUE)+
                geom_smooth(method = "lm", se = FALSE,color="black")
        r2[[i]] <- summary(lm(dd[,y]~dd[,x]))$r.squared
        }
    stats_r2 <- as.data.frame(melt(r2))
    colnames(stats_r2) <- c("R2","Period")
    rest[[s]] <- stats_r2
    
    pcplt <- do.call(grid_arrange_shared_legend,c(p,list(nrow=2,ncol=3,position="bottom")))
    ggsave(pcplt,file = paste(repsortie,"diff_initial_reg",s,".png",sep=""), width = 10, height = 6)
}
save(rest,file=paste(repsortie,"diff_initial_regR2.RData",sep=""))
```

```{r,eval=FALSE,echo=FALSE}
load(paste(repsortie,"diff_initial_regR2.RData",sep=""))
test2 <- melt(rest)

ggplot(test2, aes(x=Period,y=value)) + facet_wrap(~L1) + geom_boxplot() +
  scale_x_discrete("Périodes")+scale_y_continuous("Teneur en carbone organique (g/kg)")+
  theme(plot.title = element_text(size = 14, face = "bold"), 
        text = element_text(size = 12),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11))

```




# Modélisation test avec GBM et Cubist



## Analyse par stratification

```{r,eval=FALSE,echo=FALSE}

##### Préparation des données pour la modélisation###########################################
Rcovarclimato <- c("hpluie_an","jfroids_an","ampli_t_juil_janv","pluie_ecart_janv","pluie_ecart_juil","jpluie_janv","jpluie_juil","ttemp_an","jchauds_an")
typeclimato <- replicate(length(Rcovarclimato), "climat")

Rcovartopo <- "altimean"
typetopo <- replicate(length(Rcovartopo), "topographie")

Rcovarpedo <- c("argi_med","sabt_med","mat11")
typepedo <- replicate(length(Rcovarpedo), "pedologie")

Rcovarvaroccup <- c("var_sth1970_2000","var_sth1979_2000","var_sth1988_2000","var_c1970_2000","var_c1979_2000","var_c1988_2000","var_sfp1970_2000","var_sfp1979_2000","var_sfp1988_2000","var_mf1970_2000","var_mf1979_2000","var_mf1988_2000","var_prairie1970_2000","var_prairie1979_2000","var_prairie1988_2000","var_ugb1988_2010","var_cop1988_2000","var_cop1979_2000","var_sth1970_2010","var_sth1979_2010","var_sth1988_2010","var_c1970_2010","var_c1979_2010","var_c1988_2010","var_sfp1970_2010","var_sfp1979_2010","var_sfp1988_2010","var_mf1970_2010","var_mf1979_2010","var_mf1988_2010","var_prairie1970_2010","var_prairie1979_2010","var_prairie1988_2010","var_ugb1988_2010","var_cop1988_2010","var_cop1979_2010","eff_corgox9094","eff_corgox9599","eff_corgox0004","eff_corgox0509","eff_corgox1014")

Rcovaroccup <- c("p_sfp1988","elevage1988","elevagehorsol1988","polyelevage1988","p_prairie1970","p_prairie1979","p_prairie1988","p_sfp1970","p_sfp1979","p_mf1988","p_sth1970","p_sth1979","p_sth1988","p_mf1970","p_mf1979","p_mf1988","ugbta1988","grdcultures1988","p_cop1970","p_cop1979","p_cop1988","p_c1988","p_c1970","p_c1979")

typeoccup <- replicate(length(c(Rcovaroccup,Rcovarvaroccup)), "occup")

type <- c(typetopo,typepedo,typeoccup,typeclimato)
Rcovar <- c(Rcovartopo,Rcovarpedo,Rcovaroccup,Rcovarvaroccup,Rcovarclimato)

nbr <- 10
prob <- 0.8
model <- "cubist"

# Paramètres pour les boucles
periodetud <- c("14","24","15","25","13","35")
reg_elevage <- c("A","B1","B2","C1","C2","D","E1","E2","G1","G2")
nomdiff <- read.csv(paste(repmetadonnees,"Nomenclature_evolutionbdat.csv",sep=""),sep=",",colClasses = "character")
coname <- "corgox"

drest <- list()
dimpvar <- list()
dRMSE <- list()
dR2 <- list()

for(x in periodetud){

    diffname <- paste("reladiff",x,sep="")
    period1 <- paste(coname,nomdiff[nomdiff$Code %in% x,"Periode1"],sep="")
    period2 <- paste(coname,nomdiff[nomdiff$Code %in% x,"Periode2"],sep="")
    vNames <- c(diffname,Rcovar)
    dcast.bdat[diffname] <- ((dcast.bdat[,period2]-dcast.bdat[,period1])/dcast.bdat[,period1])*100
    d <- dcast.bdat[complete.cases(dcast.bdat[vNames]),]

    # Variables de stockages
    impvar <- list()
    p_regelevage <- list()
    rest <- array(NA, dim = c(length(reg_elevage), 3),list(strates = reg_elevage, mod = c("r2","MSE","RMSE")))
    R2 <- list()
    RMSE <- list()
    cpt <- 0
    for(i in reg_elevage){
       cpt <- cpt + 1
        print(i)
  
        d_typo <- dcast.bdat[complete.cases(dcast.bdat[vNames]) & dcast.bdat$zonage_cplt %in% i,vNames]
  
        datax <- d_typo[, vNames[-1]]
        datay <- d_typo[, vNames[1]]
 
        # Paramètres de modélisation
        trControl <- trainControl(method = "cv",p=prob,number=10)
        tuneGrid <- list(gbm=expand.grid(interaction.depth = c(1, 5, 9),n.trees = (1:10)*150,shrinkage = 0.1,n.minobsinnode = 10),cubist=expand.grid(.committees = c(10,50,100),.neighbors = c(1,5,9)))

        # Modélisation avec les meilleurs paramètres
        mcubistbst <- cv_datamining(datax,datay,nbr=nbr,prob,model,tuneGrid,trControl,select=1:15,repsortie)

        rest[cpt,"r2"] <- mcubistbst$qualityindex[,"R2"][[1]]
        rest[cpt,"MSE"] <- mcubistbst$qualityindex[,"MSE"][[1]]
        rest[cpt,"RMSE"] <- mcubistbst$qualityindex[,"RMSE"][[1]]
        
        # Pour récupérer l'ensemble des R2 et RMSE
        R2[[i]] <- as.data.frame(unlist(mcubistbst$R2))[[1]]
        RMSE[[i]] <- as.data.frame(unlist(mcubistbst$RMSE))[[1]]

        #p_regelevage[[cpt]] <- mcubistbst$p + labs(title=i)
        impvar[[i]] <- mcubistbst$varimport
    }

    dimpvar[[x]] <- impvar
    drest[[x]] <- rest
    dR2[[x]] <- R2
    dRMSE[[x]] <- RMSE
}
save(drest,file=paste(repsortie,"drestcubistdiff_typoclim.RData",sep=""))
save(dimpvar,file=paste(repsortie,"dimpvarcubistdiff_typoclim.RData",sep=""))
save(dR2,file=paste(repsortie,"dR2varcubistdiff_typoclim.RData",sep=""))
save(dRMSE,file=paste(repsortie,"dRMSEpvarcubistdiff_typoclim.RData",sep=""))
```

```{r,eval=TRUE,echo=FALSE}
# Chargement
#load(paste(repsortie,"pcubist_typoclim.RData",sep=""))
#do.call(grid_arrange_shared_legend,c(p,list(nrow=3,ncol=3,position="bottom")))

load(paste(repsortie,"drestcubistdiff_typoclim.RData",sep=""))
periodetud <- c("14","24","15","25","13","35")

# Mise en forme des résultats
load(paste(repsortie,"dR2varcubistdiff_typoclim.RData",sep=""))
test <- melt(dR2)
str(test)
ggplot(test, aes(x=L2,y=value)) + facet_wrap(~L1) + geom_boxplot() +
  scale_x_discrete("Périodes")+scale_y_continuous("Teneur en carbone organique (g/kg)")+
  theme(plot.title = element_text(size = 14, face = "bold"), 
        text = element_text(size = 12),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11))






drest[1:10][[2]]

    rest_cubistlmregelevage <- melt(drest[[i]][[3]])
    colnames(rest_lmregelevage)[5] <- "Period"



rest_lmregelevage <- rest_lmregelevage[,c("strates","Period","mod","value")]

pander(rest_lmclim,caption="Résultats des régressions linéaires pour les différentes régions d'élevage et les différentes périodes de temps comparées")





#####
load(paste(repsortie,"drest_lm_regelevage.RData",sep=""))

# Mise en forme
rest_lmregelevage <- melt(drest)
colnames(rest_lmregelevage)[5] <- "Period"
rest_lmregelevage <- rest_lmregelevage[,c("strates","Period","mod","value")]



```










### Régression linéaire multiple



#### Par type de climat

```{r,eval=FALSE,echo=FALSE}

##### Préparation des données pour la modélisation###########################################
Rcovarclimato <- c("hpluie_an","jfroids_an","ampli_t_juil_janv","pluie_ecart_janv","pluie_ecart_juil","jpluie_janv","jpluie_juil","ttemp_an","jchauds_an")
typeclimato <- replicate(length(Rcovarclimato), "climat")

Rcovartopo <- "altimean"
typetopo <- replicate(length(Rcovartopo), "topographie")

Rcovarpedo <- c("argi_med","sabt_med")
typepedo <- replicate(length(Rcovarpedo), "pedologie")

Rcovarvaroccup <- c("var_sth1970_2000","var_sth1979_2000","var_sth1988_2000","var_c1970_2000","var_c1979_2000","var_c1988_2000","var_sfp1970_2000","var_sfp1979_2000","var_sfp1988_2000","var_mf1970_2000","var_mf1979_2000","var_mf1988_2000","var_prairie1970_2000","var_prairie1979_2000","var_prairie1988_2000","var_ugb1988_2010","var_cop1988_2000","var_cop1979_2000","var_sth1970_2010","var_sth1979_2010","var_sth1988_2010","var_c1970_2010","var_c1979_2010","var_c1988_2010","var_sfp1970_2010","var_sfp1979_2010","var_sfp1988_2010","var_mf1970_2010","var_mf1979_2010","var_mf1988_2010","var_prairie1970_2010","var_prairie1979_2010","var_prairie1988_2010","var_ugb1988_2010","var_cop1988_2010","var_cop1979_2010","eff_corgox9094","eff_corgox9599","eff_corgox0004","eff_corgox0509","eff_corgox1014")

Rcovaroccup <- c("p_sfp1988","elevage1988","elevagehorsol1988","polyelevage1988","p_prairie1970","p_prairie1979","p_prairie1988","p_sfp1970","p_sfp1979","p_mf1988","p_sth1970","p_sth1979","p_sth1988","p_mf1970","p_mf1979","p_mf1988","ugbta1988","grdcultures1988","p_cop1970","p_cop1979","p_cop1988","p_c1988","p_c1970","p_c1979")

typeoccup <- replicate(length(c(Rcovaroccup,Rcovarvaroccup)), "occup")

type <- c(typetopo,typepedo,typeoccup,typeclimato)
Rcovar <- c(Rcovartopo,Rcovarpedo,Rcovaroccup,Rcovarvaroccup,Rcovarclimato)

nbr <- 100
prob <- 0.8
model <- "lm"

# Paramètres pour les boucles
periodetud <- c("14","24","15","25","13","35")
reg_elevage <- c("A","B1","B2","C1","C2","D","E1","E2","G1","G2")
nomdiff <- read.csv(paste(repmetadonnees,"Nomenclature_evolutionbdat.csv",sep=""),sep=",",colClasses = "character")
coname <- "corgox"

drest <- list()
for(x in periodetud){

    diffname <- paste("reladiff",x,sep="")
    period1 <- paste(coname,nomdiff[nomdiff$Code %in% x,"Periode1"],sep="")
    period2 <- paste(coname,nomdiff[nomdiff$Code %in% x,"Periode2"],sep="")
    vNames <- c(diffname,Rcovar)
    dcast.bdat[diffname] <- ((dcast.bdat[,period2]-dcast.bdat[,period1])/dcast.bdat[,period1])*100
    d <- dcast.bdat[complete.cases(dcast.bdat[vNames]),]

    # Variables de stockages
    impvar <- list()
    p_regelevage <- list()
    rest <- array(NA, dim = c(length(reg_elevage), 3),list(strates = reg_elevage, mod = c("r2","MSE","RMSE")))
    cpt <- 0
    for(i in reg_elevage){
       cpt <- cpt + 1
        print(i)
        d_typo <- dcast.bdat[complete.cases(dcast.bdat[vNames]) & dcast.bdat$zonage_cplt %in% i,vNames]
  
        datax <- d_typo[, vNames[-1]]
        datay <- d_typo[, vNames[1]]
         
        # Modélisation avec les meilleurs paramètres
        mcubistbst <- try(cv_datamining(datax,datay,nbr=nbr,prob,model,yname=diffname,select=1:15,repsortie),silent=TRUE)

        if(class(mcubistbst)[1]=="try-error"){
            print("Problème")
            next
        }else{
            rest[cpt,"r2"] <- mcubistbst$qualityindex[,"R2"][[1]]
            rest[cpt,"MSE"] <- mcubistbst$qualityindex[,"MSE"][[1]]
            rest[cpt,"RMSE"] <- mcubistbst$qualityindex[,"RMSE"][[1]]
         }
    }
    drest[[x]] <- list(rest)
}
save(drest,file=paste(repsortie,"drest_lm_regelevage.RData",sep=""))

```

```{r,eval=TRUE,echo=FALSE}
# Chargement
load(paste(repsortie,"drest_lm_regelevage.RData",sep=""))

# Mise en forme
rest_lmregelevage <- melt(drest)
colnames(rest_lmregelevage)[5] <- "Period"
rest_lmregelevage <- rest_lmregelevage[,c("strates","Period","mod","value")]

pander(rest_lmclim,caption="Résultats des régressions linéaires pour les différentes régions d'élevage et les différentes périodes de temps comparées")
```





#### Avec les régions d'élevage

```{r,eval=FALSE,echo=FALSE}

##### Préparation des données pour la modélisation###########################################
Rcovarclimato <- c("hpluie_an","jfroids_an","ampli_t_juil_janv","pluie_ecart_janv","pluie_ecart_juil","jpluie_janv","jpluie_juil","ttemp_an","jchauds_an")
typeclimato <- replicate(length(Rcovarclimato), "climat")

Rcovartopo <- "altimean"
typetopo <- replicate(length(Rcovartopo), "topographie")

Rcovarpedo <- c("argi_med","sabt_med")
typepedo <- replicate(length(Rcovarpedo), "pedologie")

Rcovarvaroccup <- c("var_sth1970_2000","var_sth1979_2000","var_sth1988_2000","var_c1970_2000","var_c1979_2000","var_c1988_2000","var_sfp1970_2000","var_sfp1979_2000","var_sfp1988_2000","var_mf1970_2000","var_mf1979_2000","var_mf1988_2000","var_prairie1970_2000","var_prairie1979_2000","var_prairie1988_2000","var_ugb1988_2010","var_cop1988_2000","var_cop1979_2000","var_sth1970_2010","var_sth1979_2010","var_sth1988_2010","var_c1970_2010","var_c1979_2010","var_c1988_2010","var_sfp1970_2010","var_sfp1979_2010","var_sfp1988_2010","var_mf1970_2010","var_mf1979_2010","var_mf1988_2010","var_prairie1970_2010","var_prairie1979_2010","var_prairie1988_2010","var_ugb1988_2010","var_cop1988_2010","var_cop1979_2010","eff_corgox9094","eff_corgox9599","eff_corgox0004","eff_corgox0509","eff_corgox1014")

Rcovaroccup <- c("p_sfp1988","elevage1988","elevagehorsol1988","polyelevage1988","p_prairie1970","p_prairie1979","p_prairie1988","p_sfp1970","p_sfp1979","p_mf1988","p_sth1970","p_sth1979","p_sth1988","p_mf1970","p_mf1979","p_mf1988","ugbta1988","grdcultures1988","p_cop1970","p_cop1979","p_cop1988","p_c1988","p_c1970","p_c1979")

typeoccup <- replicate(length(c(Rcovaroccup,Rcovarvaroccup)), "occup")

type <- c(typetopo,typepedo,typeoccup,typeclimato)
Rcovar <- c(Rcovartopo,Rcovarpedo,Rcovaroccup,Rcovarvaroccup,Rcovarclimato)

nbr <- 100
prob <- 0.8
model <- "lm"

# Paramètres pour les boucles
periodetud <- c("14","24","15","25","13","35")
nomdiff <- read.csv(paste(repmetadonnees,"Nomenclature_evolutionbdat.csv",sep=""),sep=",",colClasses = "character")
coname <- "corgox"

drest <- list()
for(x in periodetud){

    diffname <- paste("reladiff",x,sep="")
    period1 <- paste(coname,nomdiff[nomdiff$Code %in% x,"Periode1"],sep="")
    period2 <- paste(coname,nomdiff[nomdiff$Code %in% x,"Periode2"],sep="")
    vNames <- c(diffname,Rcovar)
    dcast.bdat[diffname] <- ((dcast.bdat[,period2]-dcast.bdat[,period1])/dcast.bdat[,period1])*100
    d <- dcast.bdat[complete.cases(dcast.bdat[vNames]),]

    # Variables de stockages
    impvar <- list()
    p_regelevage <- list()
    strates <- 3:5
    rest <- array(NA, dim = c(length(strates), 3),list(strates = strates, mod = c("r2","MSE","RMSE")))
    cpt <- 0
    for(i in strates){
       cpt <- cpt + 1
        print(i)
        d_typo <- dcast.bdat[complete.cases(dcast.bdat[vNames]) & dcast.bdat$typo_clim %in% i,vNames]
  
        datax <- d_typo[, vNames[-1]]
        datay <- d_typo[, vNames[1]]
         
        # Modélisation avec les meilleurs paramètres
        mcubistbst <- try(cv_datamining(datax,datay,nbr=nbr,prob,model,yname=diffname,select=1:15,repsortie),silent=TRUE)

        if(class(mcubistbst)[1]=="try-error"){
            print("Problème")
            next
        }else{
            rest[cpt,"r2"] <- mcubistbst$qualityindex[,"R2"][[1]]
            rest[cpt,"MSE"] <- mcubistbst$qualityindex[,"MSE"][[1]]
            rest[cpt,"RMSE"] <- mcubistbst$qualityindex[,"RMSE"][[1]]
         }
    }
    drest[[x]] <- list(rest)
}

save(drest,file=paste(repsortie,"drest_lm_typoclim.RData",sep=""))

```

```{r,eval=TRUE,echo=FALSE}
# Chargement
load(paste(repsortie,"drest_lm_typoclim.RData",sep=""))

# Mise en forme
rest_lmclim <- melt(drest)
colnames(rest_lmclim)[5] <- "Period"
rest_lmclim <- rest_lmclim[,c("strates","Period","mod","value")]

pander(rest_lmclim,caption="Résultats des régressions linéaires pour les différentes strates climatiques et les différentes périodes de temps comparées")
```
